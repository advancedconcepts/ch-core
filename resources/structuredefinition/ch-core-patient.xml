<?xml version="1.0" encoding="UTF-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
    <id value="ch-core-patient"/>
    <url value="http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-patient"/>
    <version value="0.1.0"/>
    <name value="CHCorePatientProfile"/>
    <title value="Patient"/>
    <status value="draft"/>
    <date value="2018-10-15T00:00:00+10:00"/>
    <publisher value="HL7 Switzerland"/>
    <contact>
        <name value="HL7 Switzerland"/>
        <telecom>
            <system value="url"/>
            <value value="https://www.hl7.ch/"/>
        </telecom>
    </contact>
    <description value="Core patient definition in the swiss context. Relevant are definitions by the eCH-xxx standards and CDA-CH V2 definitions.
The CH Core Patient is based upon the core FHIR Patient Resource and designed to meet the applicable patient demographic data elements in Switzerland. 
See also [BFS](https://www.bfs.admin.ch/bfs/de/home/register/personenregister/registerharmonisierung/nomenklaturen.html) for further information"/>
    <jurisdiction>
        <coding>
            <system value="urn:iso:std:iso:3166"/>
            <code value="CH"/>
        </coding>
    </jurisdiction>
    <purpose value="Core patient demographics which can be shared" />
    <fhirVersion value="3.6.0" />
    <mapping>
        <identity value="CDA-CH-V2"/>
        <uri value="https://www.hl7.ch/default/assets/File/Publikationen/180612_CDA-CH_de.pdf"/>
        <name value="CDA-CH 2017 V2"/>
    </mapping>
    <mapping>
        <identity value="eCH-0011"/>
        <uri value="http://www.ech.ch/standards/39485"/>
        <name value="eCH-0011 Datenstandard Personendaten"/>
    </mapping>
    <mapping>
        <identity value="EPR"/>
        <uri value="https://art-decor.org/art-decor/decor-valuesets--ch-epr-"/>
        <name value="EPR ValueSets"/>
    </mapping>
    <kind value="resource"/>
    <abstract value="false"/>
    <type value="Patient"/>
    <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Patient"/>
    <derivation value="constraint"/>
    <differential>
        <element id="Patient">
            <path value="Patient"/>
            <short value="CH Core Patient"/>
            <definition value="The CH Core Patient is based upon the core FHIR Patient Resource and designed to meet the applicable patient demographic data elements in Switzerland. See also https://www.bfs.admin.ch/bfs/de/home/register/personenregister/registerharmonisierung/nomenklaturen.html for further information"/>
            <constraint>
                <key value="ch-pat-1"/>
                <severity value="error"/>
                <human value="At least one HumanName with given and family name must be provided."/>
                <expression value="name.where(family.exists() and given.exists()).count()>0 or name.empty()"/>
            </constraint>
            <constraint>
                <key value="ch-pat-2"/>
                <severity value="warning"/>
                <human value="gender unknown is currently not used in Switzerland in eCH and the EPR"/>
                <expression value="gender.empty() or gender!='unknown'"/>
            </constraint>
            <mustSupport value="false"/>
            <isModifier value="false"/>
        </element>
        <element id="Patient.extension">
            <path value="Patient.extension" />
            <slicing>
                <discriminator>
                    <type value="value" />
                    <path value="url" />
                </discriminator>
                <rules value="open" />
            </slicing>
        </element>
        <element id="Patient.extension:birthPlace">
            <path value="Patient.extension" />
            <sliceName value="birthPlace" />
            <type>
                <code value="Extension" />
                <profile value="http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-patient-ech-11-placeofbirth" />
            </type>
            <mapping>
                <identity value="eCH-0011"/>
                <map value="3.3.3.2 placeOfBirth BFS-322, BFS-323, BFS 324"/>
            </mapping>
            <mapping>
                <identity value="CDA-CH-V2"/>
                <map value="hl7:recordTarget (1..1) / hl7:patientRole (1..1) / hl7:patient (1..1) / hl7:birthplace (0..1)"/>
            </mapping>
        </element>
        <element id="Patient.extension:citizenship">
            <path value="Patient.extension" />
            <sliceName value="citizenship" />
            <type>
                <code value="Extension" />
                <profile value="http://hl7.org/fhir/StructureDefinition/patient-citizenship" />
            </type>
            <mapping>
                <identity value="eCH-0011"/>
                <map value="3.3.6 nationalityData BFS-412, BFS-413"/>
            </mapping>
            <mapping>
                <identity value="CDA-CH-V2"/>
                <map value="Not supported by CDA-CH V2. Can be specified as a social history observation in the CDA body. See CDA-CH-SMCP for possible implementation: https://art-decor.org/art-decor/decor-templates--cdachsmcp-"/>
            </mapping>
        </element>
        <element id="Patient.extension:religion">
            <path value="Patient.extension" />
            <sliceName value="religion" />
            <type>
                <code value="Extension" />
                <profile value="http://hl7.org/fhir/StructureDefinition/patient-religion" />
            </type>
        </element>
        <element id="Patient.name">
            <path value="Patient.name"/>
            <short value="A name associated with the patient"/>
            <definition value="A name associated with the individual."/>
            <comment value="A patient may have multiple names with different uses or applicable periods. For animals, the name is a &quot;HumanName&quot; in the sense that is assigned and used by humans and has the same patterns."/>
            <requirements value="Need to be able to track the patient by multiple names. Examples are your official name and a partner name."/>
            <min value="1"/>
            <max value="*"/>
            <base>
                <path value="Patient.name"/>
                <min value="0"/>
                <max value="*"/>
            </base>
            <type>
                <code value="HumanName"/>
                <profile value="http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-humanname" />
            </type>
            <mapping>
                <identity value="eCH-0011"/>
                <map value="3.3.2 nameData"/>
            </mapping>
            <mapping>
                <identity value="CDA-CH-V2"/>
                <map value="hl7:recordTarget (1..1 R) / hl7:patientRole (1..1 R) / hl7:patient (1..1 R) / hl7:name (1..1 R)"/>
            </mapping>
        </element>
        <element id="Patient.telecom">
            <path value="Patient.telecom"/>
            <short value="A contact detail for the individual"/>
            <definition value="A contact detail (e.g. a telephone number or an email address) by which the individual may be contacted."/>
            <comment value="A Patient may have multiple ways to be contacted with different uses or applicable periods.  May need to have options for contacting the person urgently and also to help with identification. The address might not go directly to the individual, but may reach another party that is able to proxy for the patient (i.e. home phone, or pet owner&#39;s phone)."/>
            <requirements value="People have (primary) ways to contact them in some way such as phone, email."/>
            <min value="0"/>
            <max value="*"/>
            <type>
                <code value="ContactPoint"/>
            </type>
            <isSummary value="true"/>
            <mapping>
                <identity value="CDA-CH-V2"/>
                <map value="hl7:recordTarget (1..1 R) / hl7:patientRole (1..1 R) / hl7:telecom (0..*)"/>
            </mapping>
        </element>
        <element id="Patient.gender">
            <path value="Patient.gender"/>
            <short value="male | female | other"/>
            <definition value="Biological sex of the person or sex of the person defined by a court decision."/>
            <requirements value="The indication of sex  may only be made for persons for whom the physical sex characteristics cannot be unambiguously assigned. Swiss law does not recognise this gender. Thus, only foreign persons who have not been registered by the Swiss civil status system can be provided with this characteristic in the population controls."/>
            <min value="0"/>
            <max value="1"/>
            <type>
                <code value="code"/>
            </type>
            <isSummary value="true"/>
            <binding>
                <extension url="http://hl7.org/fhir/StructureDefinition/elementdefinition-bindingName">
                    <valueString value="AdministrativeGender"/>
                </extension>
                <extension url="http://hl7.org/fhir/StructureDefinition/elementdefinition-isCommonBinding">
                    <valueBoolean value="true"/>
                </extension>
                <strength value="required"/>
                <description value="The gender of a person used for administrative purposes."/>
                <valueSet value="http://hl7.org/fhir/ValueSet/administrative-gender"/>
            </binding>
            <mapping>
                <identity value="eCH-0011"/>
                <map value="3.3.3 sex. sexType, BFS-33, see ConceptMap http://fhir.ch/ig/ch-core/ConceptMap/sex-ech11-to-fhir"/>
            </mapping>
            <mapping>
                <identity value="CDA-CH-V2"/>
                <map value="hl7:recordTarget (1..1 R) / hl7:patientRole (1..1 R) / hl7:patient (1..1 R) / hl7:administrativeGenderCode (1..1 R), see see http://hl7.org/fhir/ConceptMap/cm-administrative-gender-v3"/>
            </mapping>
        </element>
        <element id="Patient.birthDate">
            <path value="Patient.birthDate"/>
            <short value="The date of birth for the individual"/>
            <definition value="The date of birth for the individual."/>
            <comment value="The date of birth must be valid and entered in the date format YYYY-MM-DD. In exceptional cases where the day or month of the date of birth is not known, YYYY-MM or YYYYY formats will also be accepted."/>
            <min value="0"/>
            <max value="1"/>
            <type>
                <code value="date"/>
            </type>
            <isSummary value="true"/>
            <mapping>
                <identity value="eCH-0011"/>
                <map value="3.3.3 birthData, BFS-31"/>
            </mapping>
            <mapping>
                <identity value="CDA-CH-V2"/>
                <map value="hl7:recordTarget (1..1 R) / hl7:patientRole (1..1 R) / hl7:patient (1..1 R) / hl7:birthTime (1..1 R)"/>
            </mapping>
        </element>
        <element id="Patient.maritalStatus">
            <path value="Patient.maritalStatus"/>
            <short value="Marital (civil) status of a patient"/>
            <definition value="This field contains a patient&#39;s most recent marital (civil) status."/>
            <requirements value="Most, if not all systems capture it."/>
            <min value="0"/>
            <max value="1"/>
            <base>
                <path value="Patient.maritalStatus"/>
                <min value="0"/>
                <max value="1"/>
            </base>
            <type>
                <code value="CodeableConcept"/>
            </type>
            <isModifier value="false"/>
            <isSummary value="false"/>
            <binding>
                <extension url="http://hl7.org/fhir/StructureDefinition/elementdefinition-bindingName">
                    <valueString value="MaritalStatus"/>
                </extension>
                <extension url="http://hl7.org/fhir/StructureDefinition/elementdefinition-isCommonBinding">
                    <valueBoolean value="true"/>
                </extension>
                <strength value="required"/>
                <description value="The domestic partnership status of a person."/>
                <valueSet value="http://fhir.ch/ig/ch-core/ValueSet/ch-core-maritalstatus"/>
            </binding>
           <mapping>
                <identity value="eCH-0011"/>
                <map value="3.3.5 maritalData, BFS-341, see ConceptMap http://fhir.ch/ig/ch-core/ConceptMap/maritalstatus-ech11-to-fhir"/>
            </mapping>
            <mapping>
                <identity value="CDA-CH-V2"/>
                <map value="hl7:recordTarget (1..1) / hl7:patientRole (1..1) / hl7:patient (1..1) / hl7:maritalStatusCode (0..1)"/>
            </mapping>
        </element>

        <!-- one possibility
        <element id="Patient.name">
            <path value="Patient.name"/>
            <short value="A name associated with the patient"/>
            <definition value="A name associated with the individual."/>
            <comment value="A patient may have multiple names with different uses or applicable periods. For animals, the name is a &quot;HumanName&quot; in the sense that is assigned and used by humans and has the same patterns."/>
            <requirements value="Need to be able to track the patient by multiple names. Examples are your official name and a partner name."/>
            <min value="1"/>
            <max value="*"/>
            <base>
                <path value="Patient.name"/>
                <min value="0"/>
                <max value="*"/>
            </base>
            <type>
                <code value="HumanName"/>
                <profile value="http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-humanname" />
            </type>
        </element>
-->

        <!--  
        <element id="Patient.name">
            <path value="Patient.name"/>
            <slicing>
                <discriminator>
                    <type value="value" />
                    <path value="Patient.name.use" />
                </discriminator>
                <rules value="open" />
            </slicing>
            <min value="1" />
        </element>
            
        <element id="Patient.name:humannameminimal">
            <path value="Patient.name" />
            <sliceName value="humannameminimal" />
            <min value="1" />
        </element>


        Patient/UpiEprTestKrcmarevic: Patient.name[1]	error	Unable to resolve discriminator
        Patient/UpiEprTestKrcmarevic: Patient.name[2]	error	Unable to resolve discriminator
        Patient/UpiEprTestKrcmarevic: Patient	information	Profile http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-patient, Element 'Patient.name[humannameminimal]'': Unable to check minimum required (1) due to lack of slicing validation
        <element id="Patient.name">
            <path value="Patient.name"/>
            <slicing>
                <discriminator>
                    <type value="type" />
                    <path value="$this" />
                </discriminator>
                <rules value="open" />
            </slicing>
            <min value="1" />
        </element>
        <element id="Patient.name:humannameminimal">
            <path value="Patient.name" />
            <sliceName value="humannameminimal" />
            <min value="1" />
            <type>
                <code value="HumanName" />
                <profile value="http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-humanname" />
            </type>
        </element>

        -->

    </differential>
</StructureDefinition>